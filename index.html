<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Branding Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 1em; max-width: 500px; margin: auto; }
    input, select, button { padding: 10px; margin: 10px 0; width: 100%; font-size: 1em; }
    .photo-preview { width: 100px; height: 100px; object-fit: cover; border: 1px solid #ccc; margin: 5px; }
    .photos { display: flex; flex-wrap: wrap; justify-content: space-between; }
    video { width: 100%; max-height: 300px; border: 1px solid #ccc; }
    canvas { display: none; }
    .capture-section { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h2>Car Branding Verification</h2>
  <p>Please capture all 4 sides of your car using live camera and provide your details.</p>

  <input type="text" id="driver-name" placeholder="Your Name" required>

  <select id="country-code">
    <option value="+91">ğŸ‡®ğŸ‡³ +91 (India)</option>
    <option value="+1">ğŸ‡ºğŸ‡¸ +1 (USA)</option>
    <option value="+44">ğŸ‡¬ğŸ‡§ +44 (UK)</option>
    <option value="+971">ğŸ‡¦ğŸ‡ª +971 (UAE)</option>
    <!-- Add more country codes as needed -->
  </select>

  <input type="tel" id="driver-phone" placeholder="Phone Number" required pattern="\d{7,12}">

  <div id="camera-section" class="capture-section">
    <video id="video" autoplay playsinline></video>
    <button id="snap">ğŸ“¸ Take Photo</button>
    <canvas id="canvas"></canvas>
  </div>

  <div class="photos">
    <div>
      <label>Front</label>
      <img id="img-front" class="photo-preview"><br>
      <button data-side="front" class="assign-btn">Assign</button>
    </div>
    <div>
      <label>Back</label>
      <img id="img-back" class="photo-preview"><br>
      <button data-side="back" class="assign-btn">Assign</button>
    </div>
    <div>
      <label>Left</label>
      <img id="img-left" class="photo-preview"><br>
      <button data-side="left" class="assign-btn">Assign</button>
    </div>
    <div>
      <label>Right</label>
      <img id="img-right" class="photo-preview"><br>
      <button data-side="right" class="assign-btn">Assign</button>
    </div>
  </div>

  <button id="submit-btn" disabled>Submit Verification</button>
  <div id="status"></div>

  <script>
    const endpoint = "https://formspree.io/f/mandword";
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');
    const snapBtn = document.getElementById('snap');
    const assignBtns = document.querySelectorAll('.assign-btn');
    const images = {
      front: document.getElementById('img-front'),
      back: document.getElementById('img-back'),
      left: document.getElementById('img-left'),
      right: document.getElementById('img-right')
    };
    const dataURLs = { front: null, back: null, left: null, right: null };
    let latestCapture = null;
    let locationCoords = '';

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("Camera not accessible: " + err.message));

    snapBtn.onclick = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      latestCapture = canvas.toDataURL("image/png");
      alert("Photo captured! Now assign it to a side.");
    };

    assignBtns.forEach(btn => {
      btn.onclick = () => {
        const side = btn.getAttribute('data-side');
        if (latestCapture) {
          images[side].src = latestCapture;
          dataURLs[side] = latestCapture;
          validateForm();
        } else {
          alert("Please take a photo first.");
        }
      };
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        locationCoords = pos.coords.latitude + "," + pos.coords.longitude;
        validateForm();
      });
    }

    function validateForm() {
      const name = document.getElementById('driver-name').value.trim();
      const phone = document.getElementById('driver-phone').value.trim();
      const phoneValid = /^\d{7,12}$/.test(phone);
      const allPhotos = Object.values(dataURLs).every(Boolean);
      const valid = name && phoneValid && locationCoords && allPhotos;
      document.getElementById('submit-btn').disabled = !valid;
    }

    document.getElementById('driver-name').addEventListener('input', validateForm);
    document.getElementById('driver-phone').addEventListener('input', validateForm);
    document.getElementById('country-code').addEventListener('change', validateForm);

    document.getElementById('submit-btn').onclick = () => {
      const formData = new FormData();
      formData.append("name", document.getElementById("driver-name").value);
      formData.append("phone", document.getElementById("country-code").value + document.getElementById("driver-phone").value);
      formData.append("frontPhoto", dataURLs.front);
      formData.append("backPhoto", dataURLs.back);
      formData.append("leftPhoto", dataURLs.left);
      formData.append("rightPhoto", dataURLs.right);
      formData.append("location", locationCoords);

      fetch(endpoint, {
        method: "POST",
        body: formData,
        headers: { 'Accept': 'application/json' }
      })
      .then(res => {
        if (res.ok) {
          document.getElementById("status").innerText = "âœ… Submitted successfully!";
        } else {
          document.getElementById("status").innerText = "âŒ Submission failed.";
        }
      })
      .catch(err => {
        document.getElementById("status").innerText = "âŒ Error: " + err.message;
      });
    };
  </script>
</body>
</html>
